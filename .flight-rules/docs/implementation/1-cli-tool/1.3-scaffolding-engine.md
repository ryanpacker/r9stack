# 1.3 Scaffolding Engine

## Overview

The core engine that orchestrates project creation by executing official CLI tools in sequence and applying integration code. This follows a **script-first approach**: leverage existing CLIs for each technology, then apply minimal templates only for integration glue code.

## Task Group Goals

- Execute official CLI tools in the correct order
- Handle non-interactive flags for automation
- Apply integration code after base scaffolding
- Provide progress feedback throughout the process

## Initialization Order (V1)

The engine executes these steps in sequence:

```
1. TanStack Start  â†’  Base React project with routing
2. shadcn/ui       â†’  Tailwind CSS + component library
3. Convex          â†’  Backend and database layer
4. WorkOS          â†’  Authentication integration (templates)
```

> **Note:** Stripe payment integration is deferred to post-V1.

---

## 1.3.1 CLI Orchestration

**Goal:** Execute official CLI tools in the correct sequence with proper flags.

**Steps:**
- Validate TanStack Start CLI non-interactive support (see below)
- Run `npm create @tanstack/start@latest` with appropriate flags
- Run `npx shadcn@latest init` after TanStack Start completes
- Run `npm install convex` and `npx convex init` for backend setup
- Handle errors from any CLI step and provide clear feedback
- Pass through user's package manager preference to child CLIs

**Key considerations:**
- TanStack Start CLI options: project name, package manager, toolchain, git init
- shadcn init options: style, base color, CSS variables, components path
- Convex init: creates convex/ directory and initial files

**âœ… Validation Complete: TanStack Start CLI**

TanStack Start CLI has excellent non-interactive support. Key flags:
- `project-name` - positional argument
- `--framework React|Solid` - framework choice
- `--package-manager npm|yarn|pnpm|bun|deno` - package manager
- `--toolchain eslint|biome` - linting/formatting toolchain
- `--tailwind` - add Tailwind CSS
- `--add-ons <comma-separated>` - add integrations (shadcn, convex, workos, etc.)
- `--target-dir <path>` - output directory
- `--no-git` - skip git initialization

**Built-in add-ons available:** shadcn, convex, workos, clerk, neon, sentry, prisma, drizzle, trpc, tanstack-query, storybook, and more.

**Key insight:** We don't need to orchestrate multiple CLIs. TanStack Start's add-on system handles shadcn, Convex, and WorkOS integration directly.

**Status:** âœ… Complete (validation only, partial implementation)

---

## 1.3.2 Integration Templates

**Goal:** Apply minimal template files for integration code that connects the technologies.

**Templates needed (not full project scaffolds):**
- WorkOS + Convex auth integration files
- Stripe + Convex payment integration files
- Protected route patterns
- User context provider
- Application shell with auth-aware navigation

**Steps:**
- Store integration templates in CLI package
- Copy templates to appropriate locations after CLIs complete
- Handle variable substitution (project name, etc.) in templates
- Merge with existing files where needed (e.g., adding to convex/schema.ts)

**Status:** ðŸ”µ Planned

---

## 1.3.3 Post-Scaffold Configuration

**Goal:** Modify files created by CLIs to wire everything together.

**Steps:**
- Update package.json with additional dependencies (WorkOS SDK, Stripe SDK)
- Modify Convex auth configuration for WorkOS JWT verification
- Add environment variable placeholders to .env files
- Update root layout to include providers (Convex, auth context)

**Status:** ðŸ”µ Planned

---

## 1.3.4 Dependency Installation

**Goal:** Install all dependencies after scaffolding completes.

**Steps:**
- Detect package manager from user preference or project state
- Run install command in generated project directory
- Show progress/spinner during installation
- Handle installation failures gracefully

**Status:** ðŸ”µ Planned

---

## 1.3.5 Progress Feedback

**Goal:** Keep users informed during the multi-step scaffolding process.

**Steps:**
- Show clear step indicators (Step 1/5: Creating TanStack Start project...)
- Stream output from child CLIs when appropriate
- Use spinners for longer operations
- Provide clear success/error states for each step
- Show summary of what was created on completion

**Status:** ðŸ”µ Planned
