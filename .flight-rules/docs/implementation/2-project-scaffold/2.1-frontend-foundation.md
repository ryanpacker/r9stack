# 2.1 Frontend Foundation

## Overview

Define the frontend structure of a generated project. Most comes from TanStack Start with add-ons; r9stack adds the application shell, navigation patterns, and protected routes.

> **Dependency Note:** This spec assumes TanStack Start CLI with `--add-ons shadcn,convex,workos` provides the base file structure documented below. The gap analysis task (1.3.1b) will validate these assumptions. r9stack payload templates add the components and files marked "(r9stack)" in the structure below.

## What Comes From TanStack Start + Add-ons

**TanStack Start CLI provides:**
- React project structure with SSR
- File-based routing in `src/routes/`
- Vite build configuration
- TypeScript configuration
- Package.json with scripts

**`--tailwind` flag provides:**
- Tailwind CSS configuration (v4 CSS-first)
- `src/styles.css` with base setup

**`--add-ons shadcn` provides:**
- `components.json` configuration
- `src/lib/utils.ts` with cn() helper
- Base component styles in `src/styles.css`

## What r9stack Adds (Templates)

Based on the validated target, r9stack adds:

- Application shell (AppShell, Sidebar, navigation components)
- Auth-aware user menu component
- Route structure for auth flows (`/auth/*`)
- Protected route wrapper (`/app/route.tsx`)
- Demo pages showing Convex usage

---

## 2.1.1 Target File Structure (Validated)

**Goal:** Document the complete target structure for generated projects.

```
src/
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ ui/                     # shadcn components (from add-on)
â”‚   â”‚   â””â”€â”€ button.tsx
â”‚   â”œâ”€â”€ AppShell.tsx            # Main layout wrapper (r9stack)
â”‚   â”œâ”€â”€ AuthProvider.tsx        # Auth context provider (r9stack)
â”‚   â”œâ”€â”€ ConvexClientProvider.tsx # SSR-safe Convex wrapper (r9stack)
â”‚   â”œâ”€â”€ NavGroup.tsx            # Collapsible nav section (r9stack)
â”‚   â”œâ”€â”€ NavItem.tsx             # Navigation link (r9stack)
â”‚   â”œâ”€â”€ Sidebar.tsx             # Collapsible sidebar (r9stack)
â”‚   â””â”€â”€ UserMenu.tsx            # Auth-aware user dropdown (r9stack)
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ auth.ts                 # Auth types (r9stack)
â”‚   â”œâ”€â”€ auth-client.ts          # Client-side auth context (r9stack)
â”‚   â”œâ”€â”€ auth-server.ts          # Server-side auth with iron-session (r9stack)
â”‚   â””â”€â”€ utils.ts                # cn() helper (from shadcn add-on)
â”œâ”€â”€ routes/
â”‚   â”œâ”€â”€ __root.tsx              # Root layout with providers
â”‚   â”œâ”€â”€ index.tsx               # Public landing page
â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”œâ”€â”€ callback.tsx        # OAuth callback handler
â”‚   â”‚   â”œâ”€â”€ sign-in.tsx         # Redirects to WorkOS AuthKit
â”‚   â”‚   â””â”€â”€ sign-out.tsx        # Clears session
â”‚   â””â”€â”€ app/
â”‚       â”œâ”€â”€ route.tsx           # Auth guard + AppShell wrapper
â”‚       â”œâ”€â”€ index.tsx           # Authenticated home
â”‚       â””â”€â”€ demo/
â”‚           â””â”€â”€ convex.messages.tsx  # Demo Convex page
â”œâ”€â”€ router.tsx                  # Router configuration
â”œâ”€â”€ routeTree.gen.ts            # Auto-generated route tree
â””â”€â”€ styles.css                  # Tailwind + shadcn styles
```

**Status:** âœ… Complete (structure validated in sandbox)

---

## 2.1.2 Route Structure (Validated)

**Goal:** Establish the standard route pattern for r9stack projects.

| Route | Component | Purpose | Auth |
|-------|-----------|---------|------|
| `/` | `index.tsx` | Public landing page | No |
| `/auth/sign-in` | `auth/sign-in.tsx` | Redirect to WorkOS AuthKit | No |
| `/auth/callback` | `auth/callback.tsx` | Handle OAuth callback | No |
| `/auth/sign-out` | `auth/sign-out.tsx` | Clear session, redirect | No |
| `/app` | `app/route.tsx` | Auth guard + layout | Yes |
| `/app/` | `app/index.tsx` | Authenticated home | Yes |
| `/app/demo/*` | `app/demo/*.tsx` | Demo pages | Yes |

### Auth Guard Pattern

The `/app/route.tsx` file uses TanStack Router's `beforeLoad` to check authentication:

```typescript
export const Route = createFileRoute('/app')({
  beforeLoad: async () => {
    const user = await getCurrentUser()
    if (!user) {
      throw redirect({ to: '/' })
    }
    return {}
  },
  component: AppLayout,
})

function AppLayout() {
  return (
    <AppShell>
      <Outlet />
    </AppShell>
  )
}
```

**Status:** âœ… Complete (pattern validated in sandbox)

---

## 2.1.3 Application Shell (r9stack Template)

**Goal:** Provide a functional application shell with collapsible sidebar.

### Components

| Component | Purpose |
|-----------|---------|
| `AppShell.tsx` | Main layout: sidebar + content area |
| `Sidebar.tsx` | Collapsible navigation sidebar |
| `NavGroup.tsx` | Expandable/collapsible nav section |
| `NavItem.tsx` | Individual navigation link |
| `UserMenu.tsx` | User avatar dropdown with sign out |

### AppShell Structure

```tsx
function AppShell({ children }: AppShellProps) {
  const [sidebarCollapsed, setSidebarCollapsed] = useState(false)

  return (
    <div className="flex h-screen bg-background text-foreground">
      <Sidebar
        collapsed={sidebarCollapsed}
        onToggle={() => setSidebarCollapsed(!sidebarCollapsed)}
      />
      <main className="flex-1 overflow-auto">{children}</main>
    </div>
  )
}
```

### Sidebar Features

- Collapsible with toggle button
- Logo/brand in header
- Navigation groups with expand/collapse
- User menu at bottom
- Responsive (icons only when collapsed)

**Status:** âœ… Complete (validated in sandbox)

---

## 2.1.4 shadcn Components to Add

**Goal:** Pre-install commonly needed shadcn components.

> **Dependency:** Gap analysis (1.3.1b) will determine what the shadcn add-on provides. If the add-on only provides configuration (not components), r9stack will run `npx shadcn@latest add` for the components below.

### Components to Include

Via `npx shadcn@latest add`:
- button

Additional components can be added by users as needed.

**Status:** ðŸ”µ Planned (pending gap analysis)

---

## 2.1.5 Root Layout Configuration

**Goal:** Configure the root layout with providers.

### Provider Hierarchy (Validated)

```tsx
// In __root.tsx shellComponent
function RootDocument({ children }: { children: React.ReactNode }) {
  return (
    <html lang="en">
      <head>
        <HeadContent />
      </head>
      <body>
        <AuthProvider>
          <ConvexClientProvider>
            {children}
          </ConvexClientProvider>
        </AuthProvider>
        <Scripts />
      </body>
    </html>
  )
}
```

### Key Patterns

- AuthProvider wraps ConvexClientProvider
- ConvexClientProvider is SSR-safe (creates client in useEffect)
- DevTools included for development

**Status:** âœ… Complete (pattern validated in sandbox)
