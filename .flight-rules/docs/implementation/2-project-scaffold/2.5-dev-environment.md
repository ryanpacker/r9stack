# 2.5 Dev Environment

## Overview

Set up the development environment configuration, scripts, and documentation that helps users get started quickly. Most of this is r9stack-provided content that builds on what the CLIs create.

> **Dependency Note:** TanStack Start and Convex add-ons provide base scripts. r9stack adds combined dev workflow, environment templates, and documentation via payload templates.

## What Comes From CLIs vs r9stack

| Component | Source |
|-----------|--------|
| Base package.json scripts | TanStack Start add-on |
| Convex dev configuration | Convex add-on |
| Environment templates | r9stack payload (`payload/config/`) |
| Project README | r9stack payload (`payload/config/README.md`) |

## Task Group Goals

- Provide clear scripts for development workflow
- Create environment variable templates
- Generate helpful README with setup instructions
- Include development workflow guidance

---

## 2.5.1 Package Scripts

**Goal:** Define npm scripts for common development tasks.

**Payload file:** Modify `package.json` after scaffold (or include in payload)

### Scripts to Add/Modify

```json
{
  "scripts": {
    "dev": "vinxi dev",
    "build": "vinxi build",
    "start": "vinxi start",
    "lint": "eslint .",
    "typecheck": "tsc --noEmit"
  }
}
```

### Development Workflow

The TanStack Start dev server (`vinxi dev`) runs the frontend. Convex requires a separate terminal:

```bash
# Terminal 1: Frontend
npm run dev

# Terminal 2: Convex (first time will prompt for login)
npx convex dev
```

> **Note:** We intentionally don't combine these into a single script (e.g., with `concurrently`) because:
> 1. `npx convex dev` requires interactive login on first run
> 2. Separate terminals make it easier to see logs from each service
> 3. Users can restart services independently

**Status:** ðŸ”µ Planned

---

## 2.5.2 Environment Templates

**Goal:** Provide environment variable templates with documentation.

**Payload file:** `payload/config/.env.example`

### .env.example Content

```bash
# =============================================================================
# r9stack Environment Configuration
# =============================================================================
# Copy this file to .env.local and fill in the values.
# Never commit .env.local to version control.

# -----------------------------------------------------------------------------
# Convex
# -----------------------------------------------------------------------------
# Auto-populated when you run `npx convex dev` for the first time.
# Get from: https://dashboard.convex.dev â†’ Your Project â†’ Settings â†’ URL

VITE_CONVEX_URL=

# -----------------------------------------------------------------------------
# WorkOS Authentication
# -----------------------------------------------------------------------------
# Get from: https://dashboard.workos.com â†’ Your App â†’ API Keys

WORKOS_API_KEY=sk_...
WORKOS_CLIENT_ID=client_...

# Set this to your callback URL (must match WorkOS dashboard setting)
WORKOS_REDIRECT_URI=http://localhost:3000/auth/callback

# -----------------------------------------------------------------------------
# Session Security
# -----------------------------------------------------------------------------
# Generate with: openssl rand -base64 32
# Must be at least 32 characters for iron-session encryption.

WORKOS_COOKIE_PASSWORD=
```

**Status:** ðŸ”µ Planned

---

## 2.5.3 Setup Instructions

**Goal:** Provide clear instructions for third-party service setup within the generated README.

### WorkOS Setup Instructions

```markdown
## WorkOS Setup

1. Create a WorkOS account at https://workos.com/
2. Create a new application in the WorkOS Dashboard
3. Go to **Redirects** and add: `http://localhost:3000/auth/callback`
4. Go to **API Keys** and copy:
   - **API Key** â†’ `WORKOS_API_KEY` in `.env.local`
   - **Client ID** â†’ `WORKOS_CLIENT_ID` in `.env.local`
5. (Optional) Configure authentication methods (Google, GitHub, email, etc.)
```

### Convex Setup Instructions

```markdown
## Convex Setup

1. Run `npx convex dev` in your terminal
2. If this is your first time, it will open a browser to authenticate
3. Create a new project or link to an existing one
4. The `VITE_CONVEX_URL` will be automatically added to `.env.local`
```

### Session Secret Instructions

```markdown
## Session Secret

Generate a secure password for cookie encryption:

\`\`\`bash
openssl rand -base64 32
\`\`\`

Add the output to `.env.local` as `WORKOS_COOKIE_PASSWORD`.
```

**Status:** ðŸ”µ Planned

---

## 2.5.4 Project README

**Goal:** Generate a helpful README for the scaffolded project.

**Payload file:** `payload/config/README.md`

### README Template Outline

```markdown
# {project-name}

Built with [r9stack](https://github.com/ryanpacker/r9stack) v{r9stack-version}

## Tech Stack

- **Frontend:** React 19 + TanStack Start (SSR, file-based routing)
- **Backend:** Convex (real-time, serverless)
- **Auth:** WorkOS AuthKit
- **Styling:** Tailwind CSS 4 + shadcn/ui

## Quick Start

1. Install dependencies:
   \`\`\`bash
   npm install
   \`\`\`

2. Copy environment template:
   \`\`\`bash
   cp .env.example .env.local
   \`\`\`

3. Set up services (see sections below)

4. Start development:
   \`\`\`bash
   # Terminal 1: Frontend
   npm run dev

   # Terminal 2: Convex backend
   npx convex dev
   \`\`\`

5. Open http://localhost:3000

## Setup

### WorkOS Authentication

1. Create account: https://workos.com/
2. Create application in dashboard
3. Add redirect URI: `http://localhost:3000/auth/callback`
4. Copy API Key and Client ID to `.env.local`

### Convex Backend

1. Run `npx convex dev`
2. Authenticate when prompted
3. `VITE_CONVEX_URL` is auto-added to `.env.local`

### Session Secret

Generate and add to `.env.local`:
\`\`\`bash
openssl rand -base64 32
\`\`\`

## Project Structure

\`\`\`
src/
â”œâ”€â”€ components/     # React components
â”‚   â”œâ”€â”€ ui/         # shadcn/ui components
â”‚   â””â”€â”€ ...         # App shell, navigation
â”œâ”€â”€ lib/            # Utilities and auth
â”œâ”€â”€ routes/         # File-based routing
â”‚   â”œâ”€â”€ auth/       # Auth flow routes
â”‚   â””â”€â”€ app/        # Protected routes
â””â”€â”€ styles.css      # Tailwind styles

convex/
â”œâ”€â”€ schema.ts       # Database schema
â”œâ”€â”€ messages.ts     # Example functions
â””â”€â”€ _generated/     # Auto-generated types
\`\`\`

## Available Scripts

| Script | Description |
|--------|-------------|
| `npm run dev` | Start development server |
| `npm run build` | Build for production |
| `npm run start` | Start production server |
| `npm run lint` | Run ESLint |
| `npm run typecheck` | Run TypeScript checks |

## Learn More

- [TanStack Start Docs](https://tanstack.com/start)
- [Convex Docs](https://docs.convex.dev/)
- [WorkOS AuthKit](https://workos.com/docs/user-management)
- [shadcn/ui](https://ui.shadcn.com/)
```

**Status:** ðŸ”µ Planned

---

## 2.5.5 Development Workflow

**Goal:** Document the recommended development workflow in the README.

### Key Workflow Points

1. **Two terminal workflow** - Frontend and Convex run separately
2. **Hot reload** - Both servers support hot reload
3. **Convex dashboard** - Available at https://dashboard.convex.dev for data inspection
4. **Auth testing** - Use WorkOS test mode for development

### Common Tasks

| Task | Command/Action |
|------|----------------|
| Add shadcn component | `npx shadcn@latest add button` |
| View Convex data | https://dashboard.convex.dev |
| Reset Convex data | Convex Dashboard â†’ Data â†’ Clear |
| Generate types | Automatic on `npx convex dev` |

**Status:** ðŸ”µ Planned

---

## 2.5.6 Project Versioning

**Goal:** Include versioning infrastructure in generated projects following the flight-rules pattern.

**Reference:** Follow the pattern from [flight-rules](https://github.com/ryanpacker/flight-rules)

### Version Tracking

Generated projects include version markers:

```markdown
<!-- In README.md -->
Built with [r9stack](https://github.com/ryanpacker/r9stack) v{version}
```

### Implementation

- r9stack CLI reads its own version from `package.json`
- Substitutes `{r9stack-version}` in README template during scaffold
- Users can see which r9stack version created their project

> **V1 Simplification:** Full version sync scripts (like flight-rules) are deferred. V1 just stamps the r9stack version in the README.

**Status:** ðŸ”µ Planned
